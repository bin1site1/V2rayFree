var FindProxyForURL = function(init, profiles) {
    // 代理服务器列表（仅包含IP和端口）
    var proxyList = [
        "23.247.136.254:80",
        "66.29.147.185:8080",
        "162.0.234.251:8080",
        "87.117.11.57:1080",
        "187.63.9.62:63253",
        "93.184.8.22:1080",
        "102.36.127.53:1080",
        "138.199.25.13:3909",
        "117.74.65.207:5441",
        "91.200.115.49:1080",
        "185.87.121.35:8975",
        "185.87.121.5:8975",
        "185.86.5.162:8975",
        "202.6.233.59:7878",
        "113.160.188.21:1080",
        "62.255.223.195:8080",
        "183.87.160.62:83",
        "67.206.213.202:55555",
        "156.200.123.17:8080",
        "8.220.204.215:9080",
        "80.78.73.142:65530",
        "202.5.62.55:8080",
        "45.10.163.12:80",
        "1.180.49.222:7302",
        "188.132.222.69:8080",
        "43.228.95.138:5678",
        "192.111.129.145:16894",
        "85.163.113.58:1080",
        "209.14.98.5:8080",
        "182.16.171.65:51459",
        "103.146.137.233:1081",
        "45.61.96.20:6000",
        "91.242.228.140:8085",
        "8.211.200.183:6379",
        "66.29.128.241:12795",
        "91.242.228.53:8085",
        "103.130.183.165:8199",
        "181.115.207.114:1080",
        "91.103.120.49:443",
        "8.211.200.183:9098",
        "65.169.38.73:26592",
        "59.124.62.9:3128",
        "23.26.94.77:6059",
        "184.174.44.113:6539",
        "154.236.177.100:1977",
        "46.107.230.122:1080",
        "46.36.65.117:1080",
        "154.6.23.164:6631",
        "198.37.98.222:5752",
        "125.141.133.49:5566",
        "102.217.69.117:3128",
        "91.242.228.235:8085",
        "202.140.62.212:8080",
        "72.195.34.35:27360",
        "8.211.194.78:3128",
        "159.224.66.253:5678",
        "103.171.182.229:8080",
        "175.139.200.17:4153",
        "8.213.128.90:808",
        "8.211.194.78:8008",
        "47.250.159.65:8008",
        "47.91.29.151:80",
        "140.235.171.17:8085",
        "8.213.128.90:8118",
        "205.185.120.241:5556",
        "81.169.213.169:8888",
        "127.0.0.7:80",
        "122.210.119.110:32323",
        "77.246.100.210:8080",
        "190.97.231.0:999",
        "145.40.97.148:80",
        "174.64.199.82:4145",
        "103.228.117.118:48293",
        "198.177.125.181:3949",
        "125.25.57.57:4153",
        "31.58.26.39:6622",
        "184.178.172.23:4145",
        "46.45.108.149:3128",
        "91.203.179.72:65056",
        "47.251.73.54:80",
        "66.135.16.53:80",
        "45.77.156.171:9091",
        "47.91.29.151:1311",
        "192.111.139.163:19404",
        "67.43.228.253:3881",
        "8.211.194.85:80",
        "91.84.99.28:8444",
        "47.91.109.17:8008",
        "188.40.57.101:80",
        "173.249.2.58:5964",
        "134.249.128.111:1080",
        "8.221.141.88:9036",
        "120.28.214.157:8080",
        "101.200.158.109:8800",
        "140.235.1.99:8085",
        "8.211.42.167:8005",
        "200.205.60.2:8080",
        "23.27.75.135:6215",
        "103.72.89.30:8097",
        "68.71.249.153:48606",
        "79.110.202.184:8081",
        "201.222.28.37:8080",
        "8.213.151.128:3128",
        "8.213.222.247:18080",
        "84.2.239.42:4153",
        "47.91.89.3:3128",
        "8.210.76.40:1100",
        "103.115.243.237:2214",
        "98.162.25.16:4145",
        "20.78.26.206:8561",
        "47.74.46.81:50",
        "51.15.210.79:16379",
        "31.58.20.37:5721",
        "147.91.22.150:80",
        "47.76.144.139:8443",
        "209.14.118.114:999",
        "47.252.81.108:8118",
        "107.172.156.129:5777",
        "45.150.23.118:6588",
        "84.55.46.85:8080",
        "94.154.127.105:8085",
        "200.174.198.158:8888",
        "38.153.133.55:9459",
        "198.8.84.3:4145",
        "8.211.51.115:1036",
        "109.224.22.36:51372",
        "152.70.137.18:8888",
        "47.238.60.156:18080",
        "103.54.57.117:50460",
        "41.217.220.214:32650",
        "72.195.34.60:27391",
        "103.48.68.34:83",
        "31.211.130.237:8192",
        "212.33.248.45:1080",
        "87.121.49.238:4145",
        "103.242.175.241:8899",
        "74.119.144.60:4145",
        "206.220.175.2:4145",
        "103.189.218.83:6969",
        "83.218.186.22:5678",
        "82.23.222.142:6448",
        "8.211.42.167:41890",
        "8.211.42.167:8083",
        "66.42.224.229:41679",
        "103.197.49.12:8080",
        "8.213.128.6:7657",
        "209.97.150.167:8080",
        "8.221.138.111:6379",
        "59.98.151.237:8080",
        "136.0.189.202:6929",
        "46.98.185.160:5678",
        "47.74.46.81:102",
        "37.131.165.19:59341",
        "180.92.212.178:5678",
        "14.251.13.0:8080",
        "94.154.127.186:8085",
        "8.215.3.250:8443",
        "20.103.12.177:3128",
        "173.211.8.41:6153",
        "119.93.123.229:4145",
        "142.93.202.130:3128",
        "202.5.56.117:2727",
        "162.144.74.156:3620",
        "65.111.23.179:3129",
        "8.213.128.6:83",
        "199.102.104.70:4145",
        "34.135.166.24:80",
        "72.195.114.169:4145",
        "123.253.108.40:8999",
        "8.213.197.208:34567",
        "72.210.208.101:4145",
        "103.144.103.155:1085",
        "24.199.124.151:3128",
        "103.217.213.124:32650",
        "103.162.66.10:8080",
        "47.238.128.246:17",
        "207.246.234.115:4669",
        "8.217.244.155:3356",
        "8.130.34.237:8000",
        "157.15.82.118:8080",
        "47.74.46.81:31433",
        "47.239.10.156:1100",
        "185.244.208.195:23699",
        "125.141.139.110:5566",
        "36.92.193.189:80",
        "177.174.126.203:8080",
        "61.171.50.169:6688",
        "37.152.183.29:3128",
        "191.96.254.151:6198",
        "103.146.185.171:1083",
        "38.170.172.221:5222",
        "94.154.127.185:8085",
        "47.90.167.27:8443",
        "192.111.137.37:18762",
        "80.74.54.148:3128",
        "31.10.83.158:8080",
        "8.211.195.139:9080",
        "8.130.54.67:9098",
        "89.175.0.74:3129",
        "103.155.169.68:8299",
        "176.208.101.50:8080",
        "123.182.233.70:7302",
        "8.211.51.115:31433",
        "104.219.214.43:8888",
        "212.174.242.114:8080",
        "177.19.167.242:80",
        "8.209.96.245:8443",
        "185.161.186.82:54321",
        "125.141.133.98:5566",
        "8.213.128.6:3132",
        "8.219.60.240:1011",
        "47.121.183.107:9999",
        "170.82.236.15:8080",
        "202.5.47.182:1080",
        "201.134.41.110:443",
        "8.213.222.157:443",
        "103.214.109.68:80",
        "193.142.36.183:8085",
        "185.77.220.207:8085",
        "98.188.47.150:4145",
        "8.220.204.92:1081",
        "47.252.11.233:443",
        "8.215.15.163:8022",
        "90.162.35.34:80",
        "64.181.240.152:3128",
        "202.136.89.134:11011",
        "47.238.128.246:8181",
        "200.37.252.122:8080",
        "97.83.40.67:5678",
        "170.239.207.178:999",
        "168.195.214.41:8800",
        "204.199.81.90:999",
        "213.143.113.82:80",
        "167.235.155.77:47287",
        "118.193.37.241:3129",
        "221.134.152.75:7302",
        "8.215.3.250:80",
        "103.146.38.7:1111",
        "47.238.60.156:6379",
        "39.102.214.199:7777",
        "89.23.112.143:80",
        "142.54.226.214:4145",
        "211.230.49.122:3128",
        "8.211.42.167:25565",
        "82.69.119.68:49200",
        "192.111.137.35:4145",
        "184.178.172.5:15303",
        "45.136.24.177:8085",
        "110.74.195.34:25",
        "184.178.172.25:15291",
        "84.39.112.144:3128",
        "154.29.235.84:6425",
        "158.69.185.37:3129",
        "190.94.212.228:999",
        "176.65.132.67:3128",
        "168.205.102.26:8080",
        "124.108.6.20:8085",
        "104.224.90.162:6323",
        "107.172.116.149:5605",
        "142.147.132.50:6245",
        "62.210.15.199:80",
        "103.156.17.158:8818",
        "8.213.195.191:8080",
        "8.220.205.172:3128",
        "149.129.226.9:5060",
        "94.154.127.152:8085",
        "91.242.228.62:8085",
        "104.207.52.32:3129",
        "157.250.203.234:8080",
        "184.181.217.220:4145",
        "184.174.24.155:6731",
        "88.135.210.179:8080",
        "137.184.228.194:40886",
        "208.163.39.218:53281",
        "76.81.6.107:31008",
        "201.182.204.18:9999",
        "203.217.101.144:80",
        "102.36.127.53:1080",
        "94.154.127.163:8085",
        "109.168.173.173:1080",
        "192.252.211.197:14921",
        "196.221.197.195:1976",
        "67.201.58.190:4145",
        "107.173.36.70:5525",
        "20.27.15.111:8561",
        "8.213.129.20:3127",
        "8.213.134.213:18080",
        "152.2.60.135:80",
        "51.210.156.30:51771",
        "103.133.27.159:8085",
        "8.210.4.18:7779",
        "102.0.21.14:8080",
        "45.128.135.1:1080",
        "45.41.169.128:6789",
        "205.185.126.51:5556",
        "91.242.228.155:8085",
        "77.104.76.230:8080",
        "216.26.244.189:3129",
        "91.242.228.160:8085",
        "103.81.194.165:8080",
        "188.132.222.10:8080",
        "91.84.99.28:80",
        "39.102.214.192:8888",
        "45.41.169.57:6718",
        "47.238.60.156:18081",
        "198.37.118.12:5471",
        "159.203.61.169:3128",
        "179.57.254.39:4145",
        "94.154.127.44:8085",
        "202.5.60.46:5020",
        "201.148.32.162:80",
        "173.211.8.148:6260",
        "8.221.139.222:8443",
        "106.14.104.220:3128"
        // 可以在这里添加更多代理服务器（格式：IP:端口）
    ];
    
    // 代理类型前缀
    var proxyType = "SOCKS5 ";
    
    // 存储延迟测试结果
    var latencyResults = {};
    var fastestProxy = proxyList[0]; // 默认使用第一个代理的地址和端口
    
    // 初始化延迟测试
    function initLatencyTest() {
        var testImage = new Image();
        var startTime;
        // 使用必应的favicon作为测试URL
        var testURL = 'https://www.bing.com/favicon.ico';
        
        // 为每个代理服务器测试延迟
        for (var i = 0; i < proxyList.length; i++) {
            (function(index) {
                var proxy = proxyList[index];
                startTime = new Date().getTime();
                
                // 使用代理服务器创建测试图像
                testImage.src = testURL;
                testImage.onload = function() {
                    var latency = new Date().getTime() - startTime;
                    latencyResults[proxy] = latency;
                    
                    // 更新最快代理
                    updateFastestProxy();
                };
                testImage.onerror = function() {
                    // 连接失败，设置高延迟
                    latencyResults[proxy] = 9999;
                };
            })(i);
        }
    }
    
    // 更新最快代理
    function updateFastestProxy() {
        var minLatency = 9999;
        var newFastestProxy = proxyList[0];
        
        for (var proxy in latencyResults) {
            if (latencyResults[proxy] < minLatency) {
                minLatency = latencyResults[proxy];
                newFastestProxy = proxy;
            }
        }
        
        fastestProxy = newFastestProxy;
    }
    
    // 初始化延迟测试
    initLatencyTest();
    
    return function(url, host) {
        "use strict";
        var result = init, scheme = url.substr(0, url.indexOf(":"));
        do {
            if (!profiles[result]) return result;
            result = profiles[result];
            if (typeof result === "function") result = result(url, host, scheme);
        } while (typeof result !== "string" || result.charCodeAt(0) === 43);
        return result;
    };
}("+proxy", {
    "+proxy": function(url, host, scheme) {
        "use strict";
        if (/^127\.0\.0\.1$/.test(host) || /^::1$/.test(host) || /^localhost$/.test(host)) return "DIRECT";
        
        // 对于HTTP和HTTPS请求，使用最快的代理服务器
        if (scheme === "http" || scheme === "https") {
            return proxyType + fastestProxy;
        }
        
        // 对于其他请求，也使用代理类型前缀加上默认代理地址
        return proxyType + "162.0.234.251:8080";
    }
});